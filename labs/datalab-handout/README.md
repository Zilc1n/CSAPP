
> â€œè¿™æ–‡ä»¶åˆ°åº•è®©æˆ‘å¹²å•¥ï¼Ÿå“ªäº›è§„åˆ™ï¼Ÿæ€ä¹ˆäº¤ä½œä¸šï¼Ÿâ€

ä¸‹é¢æˆ‘å¸®ä½  **æ€»ç»“è¿™ä»½æ–‡ä»¶çš„æ ¸å¿ƒå†…å®¹**ï¼Œä¸­è‹±æ–‡å¯¹ç…§ï¼Œä¸€ç›®äº†ç„¶ã€‚

---

# âœ… **CS\:APP Data Lab æ€»ç»“ (bits.c)**

---

## ğŸ“ æ–‡ä»¶ä½œç”¨ (Whatâ€™s this file for?)

è¿™å°±æ˜¯ä½ çš„ä½œä¸šæ–‡ä»¶ï¼Œåå­—å«ï¼š

```
bits.c
```

ä½ éœ€è¦åœ¨é‡Œé¢ **å†™å‡½æ•°å®ç°**ã€‚
æ¯é“é¢˜å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¦æ±‚ï¼š

* ç”¨æŒ‡å®šçš„ **ä½è¿ç®—** å®Œæˆ
* ä¸è®¸ç”¨ ifã€forã€whileï¼ˆé™¤æµ®ç‚¹é¢˜ï¼‰
* ä¸è®¸ç”¨å¤§çš„å¸¸æ•°ï¼Œæ¯”å¦‚ 0xffffffff
* ä¸è®¸è°ƒç”¨åˆ«çš„å‡½æ•°
* ä¸è®¸ç”¨æ•°ç»„ã€ç»“æ„ä½“ã€è”åˆä½“
* ä¸è®¸å†™å®
* ä¸è®¸ç±»å‹è½¬æ¢ï¼ˆcastï¼‰
* æµ®ç‚¹é¢˜é™¤å¤–ï¼Œæœ‰äº›è§„åˆ™æ”¾å®½

**â†’ æœ€ç»ˆä½ è¦äº¤è¿™ä¸ªæ–‡ä»¶ç»™è€å¸ˆã€‚**

> This is the file you hand in. You have to implement the functions in it according to strict rules.

---

## âœ… æ•´æ•°é¢˜ (Integer Coding Rules)

ä½ èƒ½ç”¨çš„æ“ä½œï¼š

* **æ•´å‹å¸¸æ•°**ï¼šåªèƒ½ç”¨ 0\~255 (0xFF)
* **ä¸€å…ƒè¿ç®—**ï¼š`~`  `!`
* **äºŒå…ƒè¿ç®—**ï¼š`&`  `^`  `|`  `+`  `<<`  `>>`

ç¦æ­¢ï¼š

* if, while, for, switch
* å‡½æ•°è°ƒç”¨
* å®šä¹‰å®
* æ•°ç»„ã€structã€union
* é€»è¾‘è¿ç®—ç¬¦ &&ã€||ã€-ã€ä¸‰ç›®è¿ç®—ç¬¦ ?: ç­‰
* ç±»å‹è½¬æ¢

ä¾‹å­ï¼š

```c
int pow2plus1(int x) {
    /* Compute 2^x + 1 using shift */
    return (1 << x) + 1;
}
```

---

## âœ… æµ®ç‚¹é¢˜ (Floating-Point Coding Rules)

å¯¹æµ®ç‚¹é¢˜ï¼Œè§„åˆ™å®½æ¾ä¸€äº›ï¼š

* å¯ä»¥ç”¨ **if / while / for**
* å¯ä»¥ç”¨ unsignedã€int
* å¯ä»¥ç”¨æ‰€æœ‰é€»è¾‘ã€ç®—æœ¯è¿ç®—
* å¯ä»¥ç”¨å¤§å¸¸æ•°
* ä»ç„¶ç¦æ­¢ï¼š

  * å‡½æ•°è°ƒç”¨
  * æ•°ç»„ã€structã€union
  * æµ®ç‚¹ç±»å‹ float / double / long double
  * æµ®ç‚¹å¸¸æ•°ï¼ˆæ¯”å¦‚ 1.0fï¼‰

æµ®ç‚¹æ•°æ®éƒ½ä»¥ **unsigned int** å­˜å‚¨ã€‚ä¾‹å¦‚ï¼š

* `float f` â†’ å­˜åœ¨ `unsigned uf` é‡Œ
* éœ€è¦æ‰‹å†™ bit-level æ“ä½œ

ä¾‹å¦‚ï¼š

```c
unsigned floatScale2(unsigned uf) {
    // ä¸å…è®¸å†™ float f = ...ï¼Œéƒ½å¿…é¡»ç”¨ä½è¿ç®—å¤„ç†
    return ...;
}
```

---

## âœ… å·¥å…· (Tools)

* ç”¨ `dlc` æ£€æŸ¥ï¼š

  > æ£€æµ‹è¯­æ³•ã€è¿ç®—ç¬¦ä¸ªæ•°
* ç”¨ `btest` æ£€æŸ¥æ­£ç¡®æ€§ï¼š

  > è·‘æµ‹è¯•
* ç”¨ `BDD checker` æ£€æŸ¥é€»è¾‘ç­‰ä»·ï¼š

  > ä¸¥æ ¼éªŒè¯æ‰€æœ‰è¾“å…¥

---

## âœ… å¸¸è§å°æŠ€å·§

æ¯”å¦‚æ•´æ•°é¢˜ï¼š

* å–ç›¸åæ•°ï¼š`~x + 1` â†’ -x
* ç”¨ç§»ä½ç®—ä¹˜é™¤ï¼š

  * x << n = x Ã— 2^n
  * x >> n = x Ã· 2^n
* æ£€æµ‹ x æ˜¯å¦ä¸º 0ï¼š

  ```c
  !x
  ```
* æ£€æµ‹æŸäº› bit æ˜¯å¦å…¨ä¸º 1ï¼š

  ```c
  (x & MASK) ^ MASK
  ```

æµ®ç‚¹é¢˜ï¼š

* åˆ†ç¦» sign, exponent, fraction
* exponent å…¨ 1 â†’ NaN æˆ– INF
* exponent å…¨ 0 â†’ Denorm
* ä¸èƒ½ç”¨ float ç±»å‹
* åˆæˆæµ®ç‚¹æ•°ï¼š

  ```c
  return sign | (exp << 23) | frac;
  ```

---

## âœ… æ–‡ä»¶ç»“æ„

ä½ çš„æ–‡ä»¶å¤§æ¦‚é•¿è¿™æ ·ï¼š

```c
/* å‡½æ•°å¤´æ³¨é‡Š */
int bitXor(int x, int y) {
    return ...;
}
```

æ¯”å¦‚ï¼š

```c
/*
 * bitXor - x^y using only ~ and &
 */
int bitXor(int x, int y) {
    return ~(~x & ~y) & ~(x & y);
}
```

---

## âœ… æ“ä½œä¸Šé™

æ¯é“é¢˜åé¢å†™äº†ï¼š

```
Max ops: 14
```

æ„æ€ï¼š

> ä½ æœ€å¤šç”¨ 14 ä¸ªè¿ç®—ç¬¦ (æ¯”å¦‚ \~, &, << ç­‰)

`dlc` ä¼šæ£€æŸ¥è¿™ä¸ªé™åˆ¶ã€‚

---

## âœ… æäº¤æ³¨æ„

* åƒä¸‡åˆ«åŠ  `#include <stdio.h>`
* ä¸è¦å®šä¹‰ main
* ä¸è¦å†™ printf é™¤äº†ä½ è°ƒè¯•ç”¨ï¼ˆä¹Ÿä¼šè­¦å‘Šï¼‰

---


> è¿™å°±æ˜¯ Data Labï¼Œä½ è¦ç”¨ä½è¿ç®—å†™å‡ºæ‰€æœ‰é¢˜ç›®ï¼Œä¸èƒ½ç”¨ ifã€å¾ªç¯ï¼Œä¹Ÿä¸èƒ½ç”¨ float ç±»å‹ï¼Œæœ€åäº¤è¿™ä¸€ä¸ªæ–‡ä»¶ã€‚



éå¸¸å¥½ï¼ä¸‹é¢æ˜¯ä½ æä¾›è¿™æ®µ Data Lab æ–‡æ¡£çš„ç¿»è¯‘ä¸ç®€æ˜æ€»ç»“ï¼Œé™„ä¸Šä¸­è‹±æ–‡å¯¹ç…§ï¼Œå¹¶é€‚å½“åŠ å…¥äº†ä¸€äº›å¹½é»˜ï¼ˆæ¯•ç«Ÿåš Data Lab çš„æ—¶å€™æ€»éœ€è¦ä¸€äº›ç²¾ç¥æ”¯æ’‘ â˜•ï¼‰ã€‚

---

## The CS\:APP Data Lab

ã€ŠCS\:APP æ•°æ®å®éªŒå®¤ã€‹

### Directions to Students

### ç»™å­¦ç”Ÿçš„è¯´æ˜

---

### ğŸ¯ Your Goal

> Your goal is to modify your copy of bits.c so that it passes all the tests in btest without violating any of the coding guidelines.

ä½ çš„ç›®æ ‡æ˜¯ä¿®æ”¹ä½ çš„ `bits.c` æ–‡ä»¶ï¼Œä½¿å®ƒé€šè¿‡ `btest` ä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼ŒåŒæ—¶ä¸è¿åä»»ä½•ç¼–ç è§„èŒƒã€‚

ï¼ˆç¿»è¯‘ï¼šä½ å¾—åœ¨è§„å®šåŠ¨ä½œé‡Œåšå‡ºèŠ±æ ·ï¼Œä¸èƒ½è€èµ–\~ï¼‰

---

## 0. Files æ–‡ä»¶æ¸…å•

* **Makefile**
  ç”¨äºç¼–è¯‘ `btest`ã€`fshow` å’Œ `ishow`

* **README**
  æœ¬æ–‡ä»¶ï¼ˆå°±æ˜¯ä½ æ­£åœ¨è¯»çš„è¯´æ˜ï¼‰

* **bits.c**
  éœ€è¦ä½ ä¿®æ”¹å¹¶æäº¤çš„æ ¸å¿ƒæ–‡ä»¶

* **bits.h**
  å¤´æ–‡ä»¶

* **btest.c**
  `btest` ä¸»ç¨‹åº

* **btest.h, decl.c, tests.c, tests-header.c**
  ç”¨äºæ„å»º `btest`

* **dlc**
  ç¼–ç è§„èŒƒæ£€æŸ¥å·¥å…·ï¼ˆData Lab Compilerï¼‰

* **driver.pl**
  è‡ªåŠ¨è¯„åˆ†è„šæœ¬ï¼Œç»“åˆ `btest` å’Œ `dlc` ä½¿ç”¨

* **Driverhdrs.pm**
  å¯é€‰â€œBeat the Profâ€ç«èµ›çš„å¤´æ–‡ä»¶

* **fshow\.c**
  ç”¨äºæŸ¥çœ‹æµ®ç‚¹æ•°è¡¨ç¤º

* **ishow\.c**
  ç”¨äºæŸ¥çœ‹æ•´æ•°è¡¨ç¤º

ï¼ˆç¿»è¯‘ï¼šè¦æ‰“èµ¢ Data Lab è¿™åœºä»—ï¼Œå…ˆå¾—ææ¸…å®¶ä¼™äº‹å„¿éƒ½åœ¨å“ªå„¿æ”¾ç€ã€‚ï¼‰

---

## 1. Modifying bits.c and checking with dlc

## ä¿®æ”¹ bits.c å¹¶ä½¿ç”¨ dlc æ£€æŸ¥

> IMPORTANT: Carefully read the instructions in the bits.c file before you start. These give the coding rules that you will need to follow if you want full credit.

âš ï¸ é‡è¦ï¼šåœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ä»”ç»†é˜…è¯» `bits.c` æ–‡ä»¶å†…çš„æŒ‡ä»¤ã€‚é‚£é‡Œé¢å†™ç€ä½ å¿…é¡»éµå®ˆçš„ç¼–ç è§„åˆ™ï¼Œå¦åˆ™å°±åˆ«æƒ³æ‹¿æ»¡åˆ†ã€‚

> Use the dlc compiler (./dlc) to automatically check your version of bits.c for compliance with the coding guidelines:

å¯ä»¥ç”¨ `dlc` å·¥å…·æ£€æŸ¥ä½ çš„ä»£ç æ˜¯å¦ç¬¦åˆç¼–ç è§„èŒƒï¼š

```bash
unix> ./dlc bits.c
```

å¦‚æœæ²¡é—®é¢˜ï¼Œ`dlc` ä¸ä¼šè¾“å‡ºä»»ä½•ä¸œè¥¿ï¼›å¦åˆ™ï¼Œä¼šæ‰“å°å‡ºè¿è§„ä¿¡æ¯ã€‚

å¦‚æœæƒ³ç»Ÿè®¡å„ä¸ªå‡½æ•°é‡Œç”¨äº†å¤šå°‘è¿ç®—ç¬¦ï¼Œå¯ä»¥ç”¨ `-e` å‚æ•°ï¼š

```bash
unix> ./dlc -e bits.c
```

ï¼ˆç¿»è¯‘ï¼šdlc å°±åƒæ•™ç»ƒä¸€æ ·ï¼Œä¸“ç›¯ä½ åŠ¨ä½œæ ‡å‡†ä¸æ ‡å‡†ï¼Œè¿˜ä¼šæ•°ä½ åšäº†å‡ ä¸‹ã€‚ï¼‰

> Once you have a legal solution, you can test it for correctness using the ./btest program.

å½“ä½ çš„ä»£ç é€šè¿‡è§„èŒƒæ£€æŸ¥ï¼Œå°±å¯ä»¥ç”¨ `./btest` æµ‹è¯•æ­£ç¡®æ€§ã€‚

---

## 2. Testing with btest

## ä½¿ç”¨ btest è¿›è¡Œæµ‹è¯•

> The Makefile in this directory compiles your version of bits.c with additional code to create a program (or test harness) named btest.

Makefile ä¼šæŠŠä½ çš„ `bits.c` å’Œå…¶ä»–æµ‹è¯•ä»£ç ç¼–è¯‘æˆä¸€ä¸ªå« `btest` çš„ç¨‹åºã€‚

ç¼–è¯‘å¹¶è¿è¡Œï¼š

```bash
unix> make btest
unix> ./btest [å¯é€‰å‘½ä»¤è¡Œå‚æ•°]
```

æ¯æ¬¡ä¿®æ”¹ `bits.c` éƒ½è¦é‡æ–°ç¼–è¯‘ `btest`ã€‚

å¦‚æœæ¢å¹³å°äº†ï¼ˆæ¯”å¦‚ä» Linux è·³åˆ° macOSï¼‰ï¼Œå»ºè®®å…ˆæ¸…ç†å†ç¼–è¯‘ï¼š

```bash
unix> make clean
unix> make btest
```

ï¼ˆç¿»è¯‘ï¼šåˆ«æƒ³å·æ‡’ï¼Œä¸é‡æ–°ç¼–è¯‘çš„è¯ï¼Œå°±åƒç©¿ç€æ˜¨å¤©çš„è¢œå­ä¸Šæˆ˜åœºã€‚ï¼‰

---

### btest æµ‹è¯•æœºåˆ¶

> Btest tests your code for correctness by running millions of test casesâ€¦

`btest` ä¼šç”¨æµ·é‡æµ‹è¯•ç”¨ä¾‹éªŒè¯ä½ çš„å‡½æ•°ï¼ŒåŒ…æ‹¬è¾¹ç•Œå€¼ï¼ˆæ¯”å¦‚æ•´æ•°é¢˜é‡Œçš„ Tminã€0ï¼Œæµ®ç‚¹é¢˜é‡Œçš„ 0ã€infã€éè§„æ ¼åŒ–æ•°ç­‰ï¼‰ã€‚

ä¸€æ—¦æŸä¸ªå‡½æ•°å‡ºé”™ï¼Œå®ƒä¼šæ‰“å°ï¼š

* å“ªä¸ªæµ‹è¯•å¤±è´¥
* é”™è¯¯ç»“æœ
* é¢„æœŸç»“æœ

ç„¶åç»ˆæ­¢è¯¥å‡½æ•°çš„åç»­æµ‹è¯•ã€‚

---

### btest å‘½ä»¤è¡Œé€‰é¡¹

```bash
unix> ./btest -h
Usage: ./btest [-hg] [-r <n>] [-f <name> [-1|-2|-3 <val>]*] [-T <time limit>]
  -1 <val>  æŒ‡å®šç¬¬ä¸€ä¸ªå‚æ•°
  -2 <val>  æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°
  -3 <val>  æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°
  -f <name> åªæµ‹è¯•æŒ‡å®šå‡½æ•°
  -g        ç²¾ç®€è¾“å‡ºï¼Œæ–¹ä¾¿è‡ªåŠ¨è¯„åˆ†
  -h        æ‰“å°å¸®åŠ©
  -r <n>    ç»™æ‰€æœ‰é¢˜ç›®ç»Ÿä¸€æƒé‡ n
  -T <lim>  è®¾ç½®è¶…æ—¶é™åˆ¶
```

ç¤ºä¾‹ï¼š

* æµ‹å…¨éƒ¨å‡½æ•°å¹¶æ‰“å°é”™è¯¯ï¼š

  ```bash
  unix> ./btest
  ```

* ç²¾ç®€è¾“å‡ºï¼ˆæ— é”™è¯¯æç¤ºï¼‰ï¼š

  ```bash
  unix> ./btest -g
  ```

* å•æµ‹å‡½æ•° fooï¼š

  ```bash
  unix> ./btest -f foo
  ```

* å•æµ‹å‡½æ•° fooï¼ŒæŒ‡å®šå‚æ•°ï¼š

  ```bash
  unix> ./btest -f foo -1 27 -2 0xf
  ```

ï¼ˆç¿»è¯‘ï¼šæƒ³è°ƒè¯•å•ä¸ªå‡½æ•°ï¼Ÿbtest å¸®ä½ ç‚¹èœï¼Œæƒ³åƒå•¥æµ‹å•¥ã€‚ï¼‰

---

## 3. Helper Programs

## è¾…åŠ©ç¨‹åº

æä¾›ä¸¤ä¸ªå·¥å…·ï¼Œå¸®ä½ çœ‹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼š

* **ishow**ï¼šæŸ¥çœ‹æ•´æ•°
* **fshow**ï¼šæŸ¥çœ‹æµ®ç‚¹æ•°

å…ˆç¼–è¯‘ï¼š

```bash
unix> make
```

ç¤ºä¾‹ï¼š

```bash
unix> ./ishow 0x27
Hex = 0x00000027,	Signed = 39,	Unsigned = 39

unix> ./ishow 27
Hex = 0x0000001b,	Signed = 27,	Unsigned = 27

unix> ./fshow 0x15213243
Floating point value 3.255334057e-26
Bit Representation 0x15213243, sign = 0, exponent = 0x2a, fraction = 0x213243
Normalized.  +1.2593463659 X 2^(-85)

unix> ./fshow 15213243
Floating point value 2.131829405e-38
Bit Representation 0x00e822bb, sign = 0, exponent = 0x01, fraction = 0x6822bb
Normalized.  +1.8135598898 X 2^(-126)
```

ï¼ˆç¿»è¯‘ï¼šä¸æƒ³å¿ƒç®—äºŒè¿›åˆ¶ï¼Ÿç”¨ ishow/fshowï¼Œäººç”Ÿå°‘æ‰ 90% çš„å´©æºƒã€‚ï¼‰

---

## ç®€æ˜æ€»ç»“

* **è¦æ”¹å“ªä¸ªæ–‡ä»¶ï¼Ÿ** â†’ bits.c
* **æ€ä¹ˆæŸ¥ç¼–ç è§„èŒƒï¼Ÿ** â†’ ./dlc bits.c
* **æ€ä¹ˆæµ‹å¯¹ä¸å¯¹ï¼Ÿ** â†’ ./btest
* **æƒ³çœ‹äºŒè¿›åˆ¶ï¼Ÿ** â†’ ./ishow æˆ– ./fshow
* **å†™å®Œå°±äº¤ï¼Œåˆ«å¯„å¸Œæœ›ä¸Šå¸ä¿ä½‘ç›²æµ‹èƒ½è¿‡ã€‚**